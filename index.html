<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>打卡系統</title>
  <style>
    .container {
      display: none;
    }
    .test-mode-btn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      background-color: #4285f4;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
    }
    body {
        font-family: Microsoft JhengHei, Times New Roman;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
    }
    .container {
        max-width: 500px;
        margin: 0 auto;
        padding: 20px;
    }
    .card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        padding: 20px;
        margin-bottom: 20px;
    }
    h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
    }
    .time-display {
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        margin: 10px 0;
    }
    .status {
        text-align: center;
        font-size: 18px;
        margin: 15px 0;
        font-weight: bold;
    }
    .status.clocked-in {
        color: #BECBD3;
    }
    .status.clocked-out {
        color: #E3D0CC;
    }
    .button-container {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
    }
    button {
        padding: 12px 0;
        width: 48%;
        border: none;
        border-radius: 4px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: background 0.3s;
    }
    button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .clock-in {
        background-color: #BECBD3;
        color: white;
    }
    .clock-out {
        background-color: #E3D0CC;
        color: white;
    }
    .settings {
        display: flex;
        align-items: center;
        margin: 15px 0;
    }
    .settings label {
        margin-right: 10px;
        font-weight: bold;
    }
    .settings input {
        padding: 8px;
        width: 80px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    table th, table td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    table th {
        background-color: #f2f2f2;
    }
    .report-buttons {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
    }
    .report-button {
        background-color: #DDCFC2;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        width: 48%;
    }
    .clear-button {
        background-color: #EAE0D7;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-top: 10px;
        font-weight: bold;
        width: 100%;
    }
    .login-container {
      max-width: 400px;
      margin: 100px auto;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- 測試模式按鈕 -->
  <div class="login-container">
    <h2>打卡系統登入</h2>
    
    <!-- Google 登入區域 -->
    <div id="g_id_onload"
         data-client_id="494511053843-50jde1jfodgsfas2d43t7a03bge6t3m0.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>

    <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="sign_in_with"
         data-shape="rectangular"
         data-logo_alignment="left">
    </div>
    
    <!-- 測試模式按鈕 -->
    <button class="test-mode-btn" id="test-mode-btn">進入測試模式</button>
  </div>

  <!-- 打卡系統容器，登入後顯示 -->
  <div class="container">
    <h1>打卡與薪資計算</h1>

    <!-- 時間顯示卡片 -->
    <div class="card">
        <div>當前時間</div>
        <div class="time-display" id="current-time">00:00:00</div>
        <div class="status" id="status">未打卡</div>
    </div>

    <!-- 時薪設置卡片 -->
    <div class="card">
        <div>設置</div>
        <div class="settings">
            <label for="hourly-rate">時薪：NT</label>
            <input type="number" id="hourly-rate" value="180" min="1">
        </div>
    </div>

    <!-- 打卡按鈕卡片 -->
    <div class="card">
        <div class="button-container">
            <button id="clock-in-btn" class="clock-in">打卡上班</button>
            <button id="clock-out-btn" class="clock-out" disabled>打卡下班</button>
        </div>
    </div>

    <!-- 報表按鈕卡片 -->
    <div class="card">
        <div class="report-buttons">
            <button id="weekly-report-btn" class="report-button">產生週報表</button>
            <button id="monthly-report-btn" class="report-button">產生月報表</button>
        </div>
        <button id="clear-data-btn" class="clear-button">清除所有資料</button>
    </div>

    <!-- 記錄列表卡片 -->
    <div class="card">
        <h3>最近打卡記錄</h3>
        <div id="records-container">
            <table id="records-table">
                <thead>
                    <tr>
                        <th>日期</th>
                        <th>上班時間</th>
                        <th>下班時間</th>
                        <th>工時</th>
                        <th>薪資</th>
                    </tr>
                </thead>
                <tbody id="records-body">
                    <!-- 記錄將在此動態加載 -->
                </tbody>
            </table>
        </div>
    </div>
  </div>

  <script>
    // 測試模式按鈕事件
    document.getElementById('test-mode-btn').addEventListener('click', function() {
      document.querySelector('.container').style.display = 'block';
      document.querySelector('.login-container').style.display = 'none';
    });
    
    // 如果您想加入Google登入功能，保留這段代碼
    function handleCredentialResponse(response) {
      const id_token = response.credential;
      
      // 因為沒有後端，這裡直接顯示打卡系統
      document.querySelector('.container').style.display = 'block';
      document.querySelector('.login-container').style.display = 'none';
      
      // 如果有後端，則使用這段代碼
      /*
      fetch('/verify-token', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id_token: id_token })
      })
      .then(res => res.json())
      .then(data => {
        if (data.email === 'silvialin0810@gmail.com') {
          document.querySelector('.container').style.display = 'block';
          document.querySelector('.login-container').style.display = 'none';
        } else {
          alert("你沒有權限打卡！");
        }
      })
      .catch(err => {
        console.error(err);
        alert("驗證失敗！");
      });
      */
    }

    // DOM元素
    const currentTimeElement = document.getElementById('current-time');
    const statusElement = document.getElementById('status');
    const clockInBtn = document.getElementById('clock-in-btn');
    const clockOutBtn = document.getElementById('clock-out-btn');
    const hourlyRateInput = document.getElementById('hourly-rate');
    const weeklyReportBtn = document.getElementById('weekly-report-btn');
    const monthlyReportBtn = document.getElementById('monthly-report-btn');
    const clearDataBtn = document.getElementById('clear-data-btn');
    const recordsBody = document.getElementById('records-body');

    // 程式狀態
    let clockInTime = null;
    let isClockIn = false;

    // 設置時薪的本地儲存
    if (localStorage.getItem('hourlyRate')) {
        hourlyRateInput.value = localStorage.getItem('hourlyRate');
    }

    // 保存時薪設置
    hourlyRateInput.addEventListener('change', function() {
        localStorage.setItem('hourlyRate', this.value);
    });

    // 更新當前時間
    function updateCurrentTime() {
        const now = new Date();
        currentTimeElement.textContent = now.toLocaleTimeString('zh-TW');
    }

    // 初始化及定時更新
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);

    // 上班打卡
    clockInBtn.addEventListener('click', function() {
        clockInTime = new Date();
        isClockIn = true;
        
        // 更新狀態
        statusElement.textContent = `上班中 - 打卡時間: ${clockInTime.toLocaleTimeString('zh-TW')}`;
        statusElement.className = 'status clocked-in';
        
        // 禁用/啟用按鈕
        clockInBtn.disabled = true;
        clockOutBtn.disabled = false;
        
        // 保存記錄
        const record = {
            date: clockInTime.toLocaleDateString('zh-TW'),
            clockInTime: clockInTime.toLocaleTimeString('zh-TW'),
            clockOutTime: null,
            hoursWorked: null,
            wage: null
        };
        
        // 獲取現有記錄
        let records = JSON.parse(localStorage.getItem('workRecords') || '[]');
        records.push(record);
        localStorage.setItem('workRecords', JSON.stringify(records));
        
        // 顯示通知
        alert(`成功打卡上班！時間: ${clockInTime.toLocaleTimeString('zh-TW')}`);
    });

    // 下班打卡
    clockOutBtn.addEventListener('click', function() {
        if (!isClockIn || !clockInTime) return;
        
        const clockOutTime = new Date();
        const timeDiff = (clockOutTime - clockInTime) / 1000 / 60 / 60; // 小時
        const hourlyRate = parseFloat(hourlyRateInput.value);
        const wage = timeDiff * hourlyRate;
        
        // 更新狀態
        statusElement.textContent = '未打卡';
        statusElement
